<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<!--
 #=============================================================================#
 # Copyright (c) 2011-2016 Stephan Wahlbrink (WalWare.de) and others.
 # All rights reserved. This program and the accompanying materials
 # are made available under the terms of the Eclipse Public License v1.0
 # which accompanies this distribution, and is available at
 # http://www.eclipse.org/legal/epl-v10.html
 # 
 # Contributors:
 #     Stephan Wahlbrink - initial API and implementation
 #=============================================================================#
-->

<plugin>

<!-- debug model -->
   <extension
         point="org.eclipse.debug.ui.debugModelPresentations">
      <debugModelPresentation
            id="de.walware.statet.r.debug"
            class="de.walware.statet.r.internal.debug.ui.RDebugModelPresentation">
      </debugModelPresentation>
   </extension>
   
   <extension
         point="org.eclipse.debug.ui.detailPaneFactories">
      <detailFactories
            id="de.walware.statet.r.debug.detailPane.RBreakpointDetailPaneFactory"
            class="de.walware.statet.r.internal.debug.ui.breakpoints.BreakpointDetailFactory">
         <enablement>
            <with
                  variable="selection">
               <count
                     value="1">
               </count>
               <iterate>
                  <or>
                     <instanceof
                           value="de.walware.statet.r.debug.core.breakpoints.IRBreakpoint">
                     </instanceof>
                  </or>
               </iterate>
            </with>
         </enablement>
      </detailFactories>
   </extension>
   <extension
         point="org.eclipse.debug.ui.sourceContainerPresentations">
      <!-- platform uri not suppored -->
      <sourceContainerPresentation
            id="de.walware.statet.r.sourceContainerPresentations.REnvLibraryPathPresentation"
            containerTypeID="de.walware.statet.r.sourceContainers.REnvLibraryPathType"
            icon="icons/obj_16/r_env.png">
      </sourceContainerPresentation>
      <sourceContainerPresentation
            id="de.walware.statet.r.sourceContainerPresentations.RLibraryPresentation"
            containerTypeID="de.walware.statet.r.sourceContainers.RLibraryType"
            browserClass="de.walware.statet.r.internal.debug.ui.sourcelookup.RLibrarySourceContainerBrowser"
            icon="icons/obj_16/r_library.png">
      </sourceContainerPresentation>
      <sourceContainerPresentation
            id="de.walware.statet.r.sourceContainerPresentations.AllRProjectsPresentation"
            containerTypeID="de.walware.statet.r.sourceContainers.AllRProjectsType"
            browserClass="de.walware.statet.r.internal.debug.ui.sourcelookup.AllRProjectsSourceContainerBrowser"
            icon="icons/obj_16/r_project.png">
      </sourceContainerPresentation>
      <sourceContainerPresentation
            id="de.walware.statet.r.sourceContainerPresentations.RProjectPresentation"
            containerTypeID="de.walware.statet.r.sourceContainers.RProjectType"
            browserClass="de.walware.statet.r.internal.debug.ui.sourcelookup.RProjectSourceContainerBrowser"
            icon="icons/obj_16/r_project.png">
      </sourceContainerPresentation>
   </extension>
   <extension
         point="org.eclipse.core.runtime.adapters">
      <factory
            adaptableType="de.walware.statet.r.debug.core.sourcelookup.IRSourceLookupMatch"
            class="de.walware.statet.r.internal.debug.ui.sourcelookup.RSourceLookupAdapterFactory">
         <adapter
               type="org.eclipse.ui.model.IWorkbenchAdapter"/>
         <adapter
               type="org.eclipse.ui.IContributorResourceAdapter"/>
      </factory>
      <factory
            adaptableType="de.walware.statet.r.debug.core.IRVariable"
            class="de.walware.statet.r.internal.debug.ui.variables.VariableUIAdapterFactory">
         <adapter
               type="org.eclipse.debug.internal.ui.viewers.model.provisional.IElementLabelProvider"/>
         <adapter
               type="org.eclipse.debug.internal.ui.viewers.model.provisional.IElementEditor"/>
         <adapter
               type="org.eclipse.debug.ui.actions.IWatchExpressionFactoryAdapter"/>
      </factory>
   </extension>
   
   <extension
         point="org.eclipse.core.expressions.definitions">
      <definition
            id="de.walware.statet.r.expressions.isSelection.RDebugVariable">
         <with
               variable="selection">
            <count
                  value="1"/>
            <iterate>
               <instanceof
                     value="de.walware.statet.r.debug.core.IRVariable">
               </instanceof>
            </iterate>
         </with>
      </definition>
      <definition
            id="de.walware.statet.r.expressions.isSelection.RDebugElementVariable">
         <with
               variable="selection">
            <count
                  value="1"/>
            <iterate>
               <instanceof
                     value="de.walware.statet.r.debug.core.IRElementVariable"/>
            </iterate>
         </with>
      </definition>
      <definition
            id="de.walware.statet.r.expressions.isSelection.RDebugVariables">
         <with 
               variable="selection">
            <count
                  value="+"/>
            <iterate>
               <instanceof
                     value="de.walware.statet.r.debug.core.IRVariable">
               </instanceof>
            </iterate>
         </with>
      </definition>
      <definition
            id="de.walware.statet.r.expressions.isSelection.RDebugExpression">
         <with
               variable="selection">
            <count
                  value="1"/>
            <iterate>
               <and>
                  <instanceof
                        value="org.eclipse.debug.core.model.IExpression"/>
                  <test property="de.walware.ecommons.debug.equalsModelIdentifier"
                        value="de.walware.statet.r.debug"/>
               </and>
            </iterate>
         </with>
      </definition>
      <definition
            id="de.walware.statet.r.expressions.isSelection.RDebugExpressionWithElementVariable">
         <with
               variable="selection">
            <count
                  value="1"/>
            <iterate>
               <and>
                  <instanceof
                        value="org.eclipse.debug.core.model.IExpression"/>
                  <test property="de.walware.ecommons.debug.equalsModelIdentifier"
                        value="de.walware.statet.r.debug"/>
                  <adapt
                        type="de.walware.statet.r.debug.core.IRVariable">
                     <instanceof
                           value="de.walware.statet.r.debug.core.IRElementVariable"/>
                  </adapt>
               </and>
            </iterate>
         </with>
      </definition>
   </extension>
   
<!-- breakpoint actions --> 
   <extension
         point="org.eclipse.ui.commands">
      <command
            id="de.walware.statet.r.commands.AddExceptionBreakpoint"
            categoryId="org.eclipse.debug.ui.category.run"
            name="%commands_AddExceptionBreakpoint_label"
            description="%commands_AddExceptionBreakpoint_description"
            defaultHandler="de.walware.statet.r.internal.debug.ui.actions.AddExceptionBreakpointHandler">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.commandImages">
      <image
            commandId="de.walware.statet.r.commands.AddExceptionBreakpoint"
            icon="icons/obj_16/r_exception.png"/>
   </extension>
   
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            locationURI="menu:org.eclipse.ui.run?endof=breakpointGroup">
         <separator
               name="Debug.R.Breakpoints">
         </separator>
         <command
               commandId="de.walware.statet.r.commands.AddExceptionBreakpoint"
               label="%menus_AddExceptionBreakpoint_label">
            <visibleWhen
                  checkEnabled="false">
               <or>
                  <with
                        variable="debugContext">
                     <count value="+"/>
                  </with>
                  <with
                        variable="activePartId">
                     <equals
                           value="org.eclipse.debug.ui.BreakpointView"/>
                  </with>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isEditorActive.RSourceEditor"/>
               </or>
            </visibleWhen>
         </command>
      </menuContribution>
   </extension>
   
<!-- variable/expression actions --> 
   <extension
         point="org.eclipse.ui.commands">
      <command
            id="de.walware.statet.r.commands.InspectAttributes"
            categoryId="org.eclipse.debug.ui.category.run"
            name="%commands_InspectAttributes_label"
            description="%commands_InspectAttributes_description">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.commandImages">
      <image
            commandId="org.eclipse.jdt.debug.ui.commands.Watch"
            icon="platform:/plugin/org.eclipse.debug.ui/icons/full/etool16/watch_exp.png"
            disabledIcon="platform:/plugin/org.eclipse.debug.ui/icons/full/dtool16/watch_exp.png"/>
      <image
            commandId="org.eclipse.jdt.debug.ui.commands.Inspect"
            icon="platform:/plugin/org.eclipse.jdt.debug.ui/icons/full/etool16/insp_sbook.gif"
            disabledIcon="platform:/plugin/org.eclipse.jdt.debug.ui/icons/full/dtool16/insp_sbook.gif"/>
   </extension>
   
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            commandId="de.walware.ecommons.base.commands.CopyElementName"
            class="de.walware.statet.r.internal.debug.ui.actions.CopyQualifiedNameHandler">
         <activeWhen>
            <reference
                  definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariables"/>
         </activeWhen>
      </handler>
      <handler
            commandId="org.eclipse.jdt.ui.edit.text.java.open.editor"
            class="de.walware.statet.r.internal.debug.ui.actions.OpenInEditorHandler">
         <activeWhen>
            <reference
                  definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariable"/>
         </activeWhen>
      </handler>
      <handler
            commandId="org.eclipse.jdt.debug.ui.commands.Watch"
            class="de.walware.statet.r.internal.debug.ui.actions.WatchHandler">
         <activeWhen>
            <or>
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariables"/>
               <reference
                     definitionId="de.walware.statet.r.expressions.isPartActive.RSourceEditor"/>
            </or>
         </activeWhen>
      </handler>
      <handler
            commandId="org.eclipse.jdt.debug.ui.commands.Inspect"
            class="de.walware.statet.r.internal.debug.ui.actions.InspectHandler">
         <activeWhen>
            <or>
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariable"/>
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugExpression"/>
               <reference
                     definitionId="de.walware.statet.r.expressions.isPartActive.RSourceEditor"/>
            </or>
         </activeWhen>
         <enabledWhen>
            <and>
               <with
                     variable="debugContext">
                  <count value="+"/>
               </with>
               <or>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugElementVariable"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isPartActive.RSourceEditor"/>
               </or>
            </and>
         </enabledWhen>
      </handler>
      <handler
            commandId="de.walware.statet.r.commands.InspectAttributes"
            class="de.walware.statet.r.internal.debug.ui.actions.InspectAttributesHandler">
         <activeWhen>
            <or>
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariable"/>
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugExpression"/>
               <reference
                     definitionId="de.walware.statet.r.expressions.isPartActive.RSourceEditor"/>
            </or>
         </activeWhen>
         <enabledWhen>
            <and>
               <with
                     variable="debugContext">
                  <count value="+"/>
               </with>
               <or>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugElementVariable"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugExpressionWithElementVariable"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isPartActive.RSourceEditor"/>
               </or>
            </and>
         </enabledWhen>
      </handler>
   </extension>
   
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            locationURI="popup:org.eclipse.ui.popup.any?after=variableGroup">
         <command
               commandId="de.walware.ecommons.base.commands.CopyElementName"
               label="%menus_CopyQualifiedName_label">
            <visibleWhen
                  checkEnabled="false">
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariables"/>
            </visibleWhen>
         </command>
      </menuContribution>
      <menuContribution
            locationURI="popup:org.eclipse.ui.popup.any?after=additions">
         <separator
               name="debug.inspect"
               visible="true">
         </separator>
         <command
               commandId="org.eclipse.jdt.debug.ui.commands.Inspect"
               label="%menus_Inspect_label">
            <visibleWhen
                  checkEnabled="false">
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugElementVariable"/>
            </visibleWhen>
         </command>
         <command
               commandId="de.walware.statet.r.commands.InspectAttributes"
               label="%menus_InspectAttributes_label">
            <visibleWhen
                  checkEnabled="false">
               <or>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugElementVariable"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugExpressionWithElementVariable"/>
               </or>
            </visibleWhen>
         </command>
      </menuContribution>
      <menuContribution
            locationURI="popup:org.eclipse.ui.popup.any?after=emptyNavigationGroup">
         <command
               commandId="org.eclipse.jdt.ui.edit.text.java.open.editor"
               label="%menus_OpenInDataEditor_label">
            <visibleWhen
                  checkEnabled="false">
               <reference
                     definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariable"/>
            </visibleWhen>
         </command>
      </menuContribution>
      
      <menuContribution
            locationURI="menu:org.eclipse.ui.run?endof=Debug.R.Breakpoints">
         <separator
               name="Debug.R.Inspect"
               visible="true">
         </separator>
         <command
                commandId="org.eclipse.jdt.debug.ui.commands.Inspect">
             <visibleWhen
                   checkEnabled="false">
                <or>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariables"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugExpression"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isEditorActive.RSourceEditor"/>
                </or>
             </visibleWhen>
         </command>
         <command
                commandId="de.walware.statet.r.commands.InspectAttributes"
                label="%menus_InspectAttributes_label">
             <visibleWhen
                   checkEnabled="false">
                <or>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariable"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugExpression"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isEditorActive.RSourceEditor"/>
                </or>
             </visibleWhen>
         </command>
         <command
                commandId="org.eclipse.jdt.debug.ui.commands.Watch"
                label="%menus_Watch_label">
             <visibleWhen
                   checkEnabled="false">
                <or>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isSelection.RDebugVariables"/>
                  <reference
                        definitionId="de.walware.statet.r.expressions.isEditorActive.RSourceEditor"/>
                </or>
             </visibleWhen>
         </command>
      </menuContribution>
   </extension>

<!-- editor contributions -->
   <extension
         point="org.eclipse.core.runtime.adapters">
      <factory
            adaptableType="de.walware.statet.r.internal.ui.editors.REditor"
            class="de.walware.statet.r.internal.debug.ui.actions.RetargettableActionAdapterFactory">
         <adapter
               type="org.eclipse.debug.ui.actions.IToggleBreakpointsTarget"/>
      </factory>
   </extension>
   
   <extension
         point="org.eclipse.debug.core.launchDelegates">
      <launchDelegate
            id="de.walware.statet.r.launchDelegates.RConsoleDebug"
            type="de.walware.statet.r.launchConfigurationTypes.RConsole"
            modes="debug"
            delegate="de.walware.statet.r.internal.debug.ui.lauching.RConsoleDebugLaunchDelegate"
            sourceLocatorId="de.walware.statet.r.sourceLocators.RSourceLocator"
            sourcePathComputerId="de.walware.statet.r.sourcePathComputers.RSourcePathComputer">
      </launchDelegate>
      <launchDelegate
            id="de.walware.statet.r.launchDelegates.RRemoteConsoleDebug"
            type="de.walware.statet.r.launchConfigurationTypes.RRemoteConsole"
            modes="debug"
            delegate="de.walware.statet.r.internal.debug.ui.lauching.RRemoteConsoleDebugLaunchDelegate"
            sourceLocatorId="de.walware.statet.r.sourceLocators.RSourceLocator"
            sourcePathComputerId="de.walware.statet.r.sourcePathComputers.RSourcePathComputer">
      </launchDelegate>
   </extension>
   <extension
         point="org.eclipse.ui.editors.markerUpdaters">
      <updater
            id="de.walware.statet.r.markerUpdaters.BreakpointUpdater"
            markerType="de.walware.statet.r.debug.markers.RBreakpoint"
            class="de.walware.statet.r.internal.debug.ui.breakpoints.BreakpointMarkerUpdater">
      </updater>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            commandId="org.eclipse.jdt.debug.ui.commands.StepIntoSelection"
            class="de.walware.statet.r.internal.debug.ui.actions.StepIntoSelectionHandler">
         <activeWhen>
            <reference
                  definitionId="de.walware.statet.r.expressions.isEditorActive.RSourceEditor"/>
         </activeWhen>
         <enabledWhen>
            <with
                  variable="de.walware.statet.activeTool">
               <test
                     property="de.walware.statet.nico.isMainType"
                     value="R"
                     forcePluginActivation="false">
               </test>
            </with>
         </enabledWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.editorActions">
      <editorContribution
            id="de.walware.statet.r.debug.REditorRulerDebugActions"
            targetID="de.walware.statet.r.editors.R">
         <action
               id="org.eclipse.jdt.debug.ui.actions.ManageBreakpointRulerAction"
               actionID="RulerDoubleClick"
               class="org.eclipse.debug.ui.actions.RulerToggleBreakpointActionDelegate"
               label="ToggleBreakpoint">
         </action>
      </editorContribution>
   </extension>
   <extension
         point="org.eclipse.ui.popupMenus">
      <viewerContribution
            id="de.walware.statet.r.debug.legacy.REditorRulerMenuDebugContribution"
            targetID="de.walware.statet.r.menus.REditorRulerMenu">
         <action
               id=".EnableDisableBreakpoint"
               class="org.eclipse.debug.ui.actions.RulerEnableDisableBreakpointActionDelegate"
               label="%menus_EnableDisableBreakpoint_label"
               menubarPath="debug">
         </action>
         <action
               id=".ToggleBreakpoint"
               class="org.eclipse.debug.ui.actions.RulerToggleBreakpointActionDelegate"
               definitionId="org.eclipse.debug.ui.commands.ToggleBreakpoint"
               icon="icons/obj_16/r_breakpoint.png"
               label="%menus_ToggleBreakpoint_label"
               menubarPath="debug">
         </action>
      </viewerContribution>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            locationURI="popup:de.walware.statet.r.menus.REditorContextMenu?before=additions">
         <separator
               name="Debug.R"
               visible="true">
         </separator>
         <command
                commandId="org.eclipse.jdt.debug.ui.commands.Inspect">
            <visibleWhen
                  checkEnabled="false">
               <with
                     variable="debugContext">
                  <count value="+"/>
               </with>
            </visibleWhen>
         </command>
         <command
                commandId="de.walware.statet.r.commands.InspectAttributes">
            <visibleWhen
                  checkEnabled="false">
               <with
                     variable="debugContext">
                  <count value="+"/>
               </with>
            </visibleWhen>
         </command>
         <command
                commandId="org.eclipse.jdt.debug.ui.commands.Watch">
            <visibleWhen
                  checkEnabled="false">
               <with
                     variable="debugContext">
                  <count value="+"/>
               </with>
            </visibleWhen>
         </command>
         <separator
               name="Debug.R.additions"
               visible="true">
         </separator>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.ui.workbench.texteditor.hyperlinkDetectors">
      <hyperlinkDetector
            id="de.walware.statet.r.debug.hyperlinks.StepIntoSelectionDetector"
            targetId="de.walware.statet.r.editorHyperlinks.REditorTarget"
            class="de.walware.statet.r.internal.debug.ui.actions.StepIntoSelectionHyperlinkDetector"
            name="%hyperlinks_StepIntoSelection_name"
            activate="false"
            modifierKeys="M1+M3">
      </hyperlinkDetector>
   </extension>
   <extension
         point="de.walware.ecommons.ltk.advancedInfoHover">
      <hover
            id="de.walware.statet.r.contentInfoHover.RDebugHover"
            contentTypeId="de.walware.statet.r.contentTypes.R"
            name="Element Info from R Console"
            class="de.walware.statet.r.internal.debug.ui.actions.RDebugHover">
      </hover>
   </extension>
   
</plugin>
